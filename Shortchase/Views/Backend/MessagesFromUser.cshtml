@model MessageRetrievedAdminDto
@{
    Layout = "_DashboardLayout";
}

<div class="header bg-gradient-primary py-3 ">
    <div class="container-fluid">
        <div class="header-body">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <h1 class="text-white text-left mb-0">
                        @*<i class="fas fa-comment-dots"></i>*@
                        <img src="@Url.Content("~/img/newicons/messages.png")" class="img-fluid" width="40px" />&nbsp;
                        Messages: @Model.UserName
                    </h1>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="pt-3">
    <div class="container-fluid">
        <div class="py-2">
            <a asp-action="Messages" asp-controller="Backend" class="btn btn-link timezoneoffset"><img src="@Url.Content("~/img/newicons/back.png")" class="img-fluid" width="30px" /></a>
        </div>
        <div class="card shadow-sm">
            <div class="card-body py-2 px-3 text-smaller" style="max-height: 400px; overflow-x: none; overflow-y: auto;" id="messagesWrapper">
                @if (Model.Messages.Count <= 0)
                {
                    <text>No messages yet.</text>
                }
                else
                {
                    foreach (var item in Model.Messages)
                    {
                        string bgClass = "";
                        string title = "New";
                        if (item.DateRead.HasValue)
                        {
                            bgClass = "bg-read-message";
                            title = "Read";
                        }

                        <div class="row pb-2 " title="@title">
                            <div class="col-sm-12 col-md-12 col-lg-6 MontserratBold">
                                <p class="m-0 text-smaller">
                                    <img src="@item.SentByProfilePicture" class="img-fluid rounded-circle" width="20px" />
                                    <span>@item.SentByName</span>
                                </p>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-6 text-right text-muted">
                                @item.ParsedDateSent
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12 py-1 ">
                                <p class="m-0 p-1 text-smaller @bgClass">@item.Content</p>

                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <hr class="m-0" />
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
        <form class="row my-3" id="MessagerForm">
            <div class="col-sm-10 col-md-10 col-lg-11">
                <textarea class="no-resize form-control" id="MessagerMessageToSend" placeholder="Type your message here..."></textarea>
            </div>
            <div class="col-sm-2 col-md-2 col-lg-1">
                <button type="submit" class="btn btn-orange text-white h-100">Send</button>
            </div>
        </form>
    </div>
</div>


<input id="SendMessageURL" hidden value="@Url.Action("SendMessage", "Backend")" />
<input id="ToId" hidden value="@Model.UserId" />

@section Scripts{
    <script src="@Url.Content("~/app/Backend/MessagesFromUser.js")" asp-append-version="true"></script>
}
